<!DOCTYPE html>
<html lang="en">
<head>
    <title>2021-22 Fantasy Basketball Projections</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    <!-- Sortable -->
    <script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
    
    <!-- Custom -->
    <link rel="stylesheet" href="/static/css/style.css">
    
</head>
<body>
    <header>
        <h1>ESPN Fantasy Basketball League Analyzer</h1>
    </header>
    <div id="formsContainer">
        <form>
            <select id="fantasy_team" onchange="addURLParameter(this.id, this.value)">
                <option class="noFilter"> -- Show All Teams -- </option>
                {% for fantasy_team in filters["fantasy_team"] %}
                <option>{{ fantasy_team }}</option>
                {% endfor %}
            </select>
        </form>
        <form>
            <select id="season" onchange="addURLParameter(this.id, this.value)">
                <option class="noFilter"> -- Show All Seasons -- </option>
                {% for season in filters["season"] %}
                <option>{{ season }}</option>
                {% endfor %}
            </select>
        </form>
        <form>
            <select id="season_type" onchange="addURLParameter(this.id, this.value)">
                <option class="noFilter"> -- Show All Season Types -- </option>
                {% for season_type in filters["season_type"] %}
                <option>{{ season_type }}</option>
                {% endfor %}
            </select>
        </form>
        <form>
            <select id="stats_type" onchange="addURLParameter(this.id, this.value)">
                <option class="noFilter"> -- Show All Stats Types -- </option>
                {% for stats_type in filters["stats_type"] %}
                <option>{{ stats_type }}</option>
                {% endfor %}
            </select>
        </form>
    </div>
    <div id="tablesContainer">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Fantasy Team</th>
                    <th>Season</th>
                    <th>Season Type</th>
                    <th>Stats Type</th>
                    <th>Name</th>
                    <th>Position</th>
                    <th>Team</th>
                    <th>Injury Status</th>
                    <th>PTS</th>
                    <th>BLK</th>
                    <th>STL</th>
                    <th>AST</th>
                    <th>REB</th>
                    <th>TO</th>
                    <th>FGM</th>
                    <th>FGA</th>
                    <th>FTM</th>
                    <th>FTA</th>
                    <th>MPG</th>
                    <th>MIN</th>
                    <th>GP</th>
                    <th>TPTM</th>
                    <th>TPTA</th>
                    <th>TPTP</th>
                    <th>FGP</th>
                    <th>FTP</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in stats %}
                <tr>
                    <td>{{ stat.id }}</td>
                    <td>{{ stat.fantasy_team }}</td>
                    <td>{{ stat.season }}</td>
                    <td>{{ stat.season_type }}</td>
                    <td>{{ stat.stats_type }}</td>
                    <td>{{ stat.name }}</td>
                    <td>{{ stat.position }}</td>
                    <td>{{ stat.proTeam }}</td>
                    <td>{{ stat.injuryStatus }}</td>
                    <td>{{ stat.PTS }}</td>
                    <td>{{ stat.BLK }}</td>
                    <td>{{ stat.STL }}</td>
                    <td>{{ stat.AST }}</td>
                    <td>{{ stat.REB }}</td>
                    <td>{{ stat.TO }}</td>
                    <td>{{ stat.FGM }}</td>
                    <td>{{ stat.FGA }}</td>
                    <td>{{ stat.FTM }}</td>
                    <td>{{ stat.FTA }}</td>
                    <td>{{ stat.MPG }}</td>
                    <td>{{ stat.MIN }}</td>
                    <td>{{ stat.GP }}</td>
                    <td>{{ stat.TPTM }}</td>
                    <td>{{ stat.TPTA }}</td>
                    <td>{{ stat.TPTP }}</td>
                    <td>{{ stat.FGP }}</td>
                    <td>{{ stat.FTP }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <script src="/static/js/app.js"></script>
    <script>
        function addURLParameter(name, value) {
            var searchParams = new URLSearchParams(window.location.search)
            if (value == "-- Show All Teams --" || value == "-- Show All Seasons --" || value == "-- Show All Season Types --" || value == "-- Show All Stats Types --") {
                searchParams.delete(name);
            }
            else {
                searchParams.set(name, value);
            }
            document.cookie = name + "=" + value;
            window.location.search = searchParams.toString();
        }

        function deleteCookie(name) {   
            document.cookie = name+'=; Max-Age=-99999999;';  
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        window.onload = function onLoad() {
            if (window.location.pathname == '/') {
                deleteCookie()
            }
            let x = document.cookie;
            fantasy_team_value = getCookie('fantasy_team');
            season_value = getCookie('season');
            season_type_value = getCookie('season_type');
            stats_type_value = getCookie('stats_type');

            fantasy_team = document.getElementById('fantasy_team');
            season = document.getElementById('season');
            season_type = document.getElementById('season_type');
            stats_type = document.getElementById('stats_type');

            if (fantasy_team_value != null) {
                fantasy_team.value = fantasy_team_value
            }
            else {
                fantasy_team.value = fantasy_team.firstChild.innerHTML;
            }
            if (season_value != null) {
                season.value = season_value
            }
            else {
                season.value = season.firstChild.innerHTML;
            }
            if (season_type_value != null) {
                season_type.value = season_type_value
            }
            else {
                season_type.value = season_type.firstChild.innerHTML;
            }
            if (stats_type_value != null) {
                stats_type.value = stats_type_value
            }
            else {
                stats_type.value = stats_type.firstChild.innerHTML;
            }
        }
    </script>
</body>
</html>